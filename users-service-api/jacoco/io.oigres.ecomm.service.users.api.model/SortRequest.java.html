<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SortRequest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">API</a> &gt; <a href="index.source.html" class="el_package">io.oigres.ecomm.service.users.api.model</a> &gt; <span class="el_source">SortRequest.java</span></div><h1>SortRequest.java</h1><pre class="source lang-java linenums">/**********
 This project is free software; you can redistribute it and/or modify it under
 the terms of the GNU General Public License as published by the
 Free Software Foundation; either version 3.0 of the License, or (at your
 option) any later version. (See &lt;https://www.gnu.org/licenses/gpl-3.0.html&gt;.)

 This project is distributed in the hope that it will be useful, but WITHOUT
 ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 more details.

 You should have received a copy of the GNU General Public License
 along with this project; if not, write to the Free Software Foundation, Inc.,
 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 **********/
// Copyright (c) 2024-2025 Sergio Exposito.  All rights reserved.              

package io.oigres.ecomm.service.users.api.model;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import java.util.Optional;
import java.util.stream.Collectors;

/**
 * Sort option for queries. You have to provide at least a list of properties to sort for that must not include
 * {@literal null} or empty strings. The direction defaults to {@link SortRequest#DEFAULT_DIRECTION}.
 *
 * @author Sergio Exposito
 */
public class SortRequest implements Serializable {

  private static final long serialVersionUID = 5737186511678863905L;

<span class="nc" id="L38">  private static final SortRequest UNSORTED = SortRequest.by(new Order[0]);</span>

<span class="nc" id="L40">  public static final Direction DEFAULT_DIRECTION = Direction.ASC;</span>

  private final List&lt;Order&gt; orders;

<span class="nc" id="L44">  protected SortRequest(List&lt;Order&gt; orders) {</span>
<span class="nc" id="L45">    this.orders = orders;</span>
<span class="nc" id="L46">  }</span>

  /**
   * Creates a new {@link SortRequest} instance.
   *
   * @param direction defaults to {@link SortRequest#DEFAULT_DIRECTION} (for {@literal null} cases, too)
   * @param properties must not be {@literal null} or contain {@literal null} or empty strings.
   */
<span class="nc" id="L54">  private SortRequest(Direction direction, List&lt;String&gt; properties) {</span>

<span class="nc bnc" id="L56" title="All 4 branches missed.">    if (properties == null || properties.isEmpty()) {</span>
<span class="nc" id="L57">      throw new IllegalArgumentException(&quot;You have to provide at least one property to sort by&quot;);</span>
    }

<span class="nc" id="L60">    this.orders =</span>
<span class="nc" id="L61">        properties.stream() //</span>
<span class="nc" id="L62">            .map(it -&gt; new Order(direction, it)) //</span>
<span class="nc" id="L63">            .collect(Collectors.toList());</span>
<span class="nc" id="L64">  }</span>

  /**
   * Creates a new {@link SortRequest} for the given properties.
   *
   * @param properties must not be {@literal null}.
   * @return
   */
  public static SortRequest by(String... properties) {
<span class="nc bnc" id="L73" title="All 2 branches missed.">    return properties.length == 0 //</span>
<span class="nc" id="L74">        ? SortRequest.unsorted() //</span>
<span class="nc" id="L75">        : new SortRequest(DEFAULT_DIRECTION, Arrays.asList(properties));</span>
  }

  /**
   * Creates a new {@link SortRequest} for the given {@link Order}s.
   *
   * @param orders must not be {@literal null}.
   * @return
   */
  public static SortRequest by(List&lt;Order&gt; orders) {
<span class="nc bnc" id="L85" title="All 2 branches missed.">    return orders.isEmpty() ? SortRequest.unsorted() : new SortRequest(orders);</span>
  }

  /**
   * Creates a new {@link SortRequest} for the given {@link Order}s.
   *
   * @param orders must not be {@literal null}.
   * @return
   */
  public static SortRequest by(Order... orders) {
<span class="nc" id="L95">    return new SortRequest(Arrays.asList(orders));</span>
  }

  /**
   * Creates a new {@link SortRequest} for the given {@link Order}s.
   *
   * @param direction must not be {@literal null}.
   * @param properties must not be {@literal null}.
   * @return
   */
  public static SortRequest by(Direction direction, String... properties) {
<span class="nc" id="L106">    return SortRequest.by(</span>
<span class="nc" id="L107">        Arrays.stream(properties) //</span>
<span class="nc" id="L108">            .map(it -&gt; new Order(direction, it)) //</span>
<span class="nc" id="L109">            .collect(Collectors.toList()));</span>
  }

  /**
   * Returns a {@link SortRequest} instances representing no sorting setup at all.
   *
   * @return
   */
  public static SortRequest unsorted() {
<span class="nc" id="L118">    return UNSORTED;</span>
  }

  /**
   * Returns a new {@link SortRequest} with the current setup but descending order direction.
   *
   * @return
   */
  public SortRequest descending() {
<span class="nc" id="L127">    return withDirection(Direction.DESC);</span>
  }

  /**
   * Returns a new {@link SortRequest} with the current setup but ascending order direction.
   *
   * @return
   */
  public SortRequest ascending() {
<span class="nc" id="L136">    return withDirection(Direction.ASC);</span>
  }

  public boolean isSorted() {
<span class="nc bnc" id="L140" title="All 2 branches missed.">    return !isEmpty();</span>
  }

  public boolean isEmpty() {
<span class="nc" id="L144">    return orders.isEmpty();</span>
  }

  public boolean isUnsorted() {
<span class="nc bnc" id="L148" title="All 2 branches missed.">    return !isSorted();</span>
  }

  public List&lt;Order&gt; getOrders() {
<span class="nc" id="L152">    return List.copyOf(this.orders);</span>
  }

  public SortRequest and(SortRequest sort) {
<span class="nc" id="L156">    List&lt;Order&gt; these = new ArrayList&lt;Order&gt;(this.orders);</span>

<span class="nc bnc" id="L158" title="All 2 branches missed.">    for (Order order : sort.orders) {</span>
<span class="nc" id="L159">      these.add(order);</span>
<span class="nc" id="L160">    }</span>

<span class="nc" id="L162">    return SortRequest.by(these);</span>
  }

  /**
   * Creates a new {@link SortRequest} with the current setup but the given order direction.
   *
   * @param direction
   * @return
   */
  private SortRequest withDirection(Direction direction) {

<span class="nc" id="L173">    return SortRequest.by(</span>
<span class="nc" id="L174">        this.orders.stream().map(it -&gt; it.with(direction)).collect(Collectors.toList()));</span>
  }

  /**
   * Enumeration for sort directions.
   *
   * @author Oliver Gierke
   */
<span class="nc" id="L182">  public enum Direction {</span>
<span class="nc" id="L183">    ASC,</span>
<span class="nc" id="L184">    DESC;</span>

    /**
     * Returns whether the direction is ascending.
     *
     * @return
     * @since 1.13
     */
    public boolean isAscending() {
<span class="nc" id="L193">      return this.equals(ASC);</span>
    }

    /**
     * Returns whether the direction is descending.
     *
     * @return
     * @since 1.13
     */
    public boolean isDescending() {
<span class="nc" id="L203">      return this.equals(DESC);</span>
    }

    /**
     * Returns the {@link Direction} enum for the given {@link String} value.
     *
     * @param value
     * @throws IllegalArgumentException in case the given value cannot be parsed into an enum value.
     * @return
     */
    public static Direction fromString(String value) {

      try {
<span class="nc" id="L216">        return Direction.valueOf(value.toUpperCase(Locale.US));</span>
<span class="nc" id="L217">      } catch (Exception e) {</span>
<span class="nc" id="L218">        throw new IllegalArgumentException(</span>
<span class="nc" id="L219">            String.format(</span>
                &quot;Invalid value '%s' for orders given; Has to be either 'desc' or 'asc' (case&quot;
                    + &quot; insensitive)&quot;,
                value),
            e);
      }
    }

    /**
     * Returns the {@link Direction} enum for the given {@link String} or null if it cannot be parsed into an enum
     * value.
     *
     * @param value
     * @return
     */
    public static Optional&lt;Direction&gt; fromOptionalString(String value) {

      try {
<span class="nc" id="L237">        return Optional.of(fromString(value));</span>
<span class="nc" id="L238">      } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L239">        return Optional.empty();</span>
      }
    }
  }

  /**
   * Enumeration for null handling hints that can be used in {@link Order} expressions.
   *
   * @author Thomas Darimont
   * @since 1.8
   */
<span class="nc" id="L250">  public static enum NullHandling {</span>

    /**
     * Lets the data store decide what to do with nulls.
     */
<span class="nc" id="L255">    NATIVE,</span>

    /**
     * A hint to the used data store to order entries with null values before non null entries.
     */
<span class="nc" id="L260">    NULLS_FIRST,</span>

    /**
     * A hint to the used data store to order entries with null values after non null entries.
     */
<span class="nc" id="L265">    NULLS_LAST;</span>
  }

  /**
   * PropertyPath implements the pairing of an {@link Direction} and a property. It is used to provide input for
   * {@link SortRequest}
   *
   * @author Oliver Gierke
   * @author Kevin Raymond
   */
  public static class Order implements Serializable {

    private static final long serialVersionUID = 1522511010900108987L;
    private static final boolean DEFAULT_IGNORE_CASE = false;
<span class="nc" id="L279">    private static final NullHandling DEFAULT_NULL_HANDLING = NullHandling.NATIVE;</span>

    private final Direction direction;
    private final String property;
    private final boolean ignoreCase;
    private final NullHandling nullHandling;

    /**
     * Creates a new {@link Order} instance. if order is {@literal null} then order defaults to
     * {@link SortRequest#DEFAULT_DIRECTION}
     *
     * @param direction can be {@literal null}, will default to {@link SortRequest#DEFAULT_DIRECTION}
     * @param property must not be {@literal null} or empty.
     */
    public Order(Direction direction, String property) {
<span class="nc" id="L294">      this(direction, property, DEFAULT_IGNORE_CASE, DEFAULT_NULL_HANDLING);</span>
<span class="nc" id="L295">    }</span>

    /**
     * Creates a new {@link Order} instance. if order is {@literal null} then order defaults to
     * {@link SortRequest#DEFAULT_DIRECTION}
     *
     * @param direction can be {@literal null}, will default to {@link SortRequest#DEFAULT_DIRECTION}
     * @param property must not be {@literal null} or empty.
     * @param nullHandlingHint must not be {@literal null}.
     */
    public Order(Direction direction, String property, NullHandling nullHandlingHint) {
<span class="nc" id="L306">      this(direction, property, DEFAULT_IGNORE_CASE, nullHandlingHint);</span>
<span class="nc" id="L307">    }</span>

    /**
     * Creates a new {@link Order} instance. Takes a single property. Direction defaults to
     * {@link SortRequest#DEFAULT_DIRECTION}.
     *
     * @param property must not be {@literal null} or empty.
     * @since 2.0
     */
    public static Order by(String property) {
<span class="nc" id="L317">      return new Order(DEFAULT_DIRECTION, property);</span>
    }

    /**
     * Creates a new {@link Order} instance. Takes a single property. Direction is {@link Direction#ASC} and
     * NullHandling {@link NullHandling#NATIVE}.
     *
     * @param property must not be {@literal null} or empty.
     * @since 2.0
     */
    public static Order asc(String property) {
<span class="nc" id="L328">      return new Order(Direction.ASC, property, DEFAULT_NULL_HANDLING);</span>
    }

    /**
     * Creates a new {@link Order} instance. Takes a single property. Direction is {@link Direction#DESC} and
     * NullHandling {@link NullHandling#NATIVE}.
     *
     * @param property must not be {@literal null} or empty.
     * @since 2.0
     */
    public static Order desc(String property) {
<span class="nc" id="L339">      return new Order(Direction.DESC, property, DEFAULT_NULL_HANDLING);</span>
    }

    /**
     * Creates a new {@link Order} instance. if order is {@literal null} then order defaults to
     * {@link SortRequest#DEFAULT_DIRECTION}
     *
     * @param direction can be {@literal null}, will default to {@link SortRequest#DEFAULT_DIRECTION}
     * @param property must not be {@literal null} or empty.
     * @param ignoreCase true if sorting should be case-insensitive. false if sorting should be case-sensitive.
     * @param nullHandling must not be {@literal null}.
     * @since 1.7
     */
    private Order(
<span class="nc" id="L353">        Direction direction, String property, boolean ignoreCase, NullHandling nullHandling) {</span>

<span class="nc bnc" id="L355" title="All 4 branches missed.">      if (property == null || property.trim().isEmpty()) {</span>
<span class="nc" id="L356">        throw new IllegalArgumentException(&quot;Property must not be null or empty&quot;);</span>
      }

<span class="nc bnc" id="L359" title="All 2 branches missed.">      this.direction = direction == null ? DEFAULT_DIRECTION : direction;</span>
<span class="nc" id="L360">      this.property = property;</span>
<span class="nc" id="L361">      this.ignoreCase = ignoreCase;</span>
<span class="nc" id="L362">      this.nullHandling = nullHandling;</span>
<span class="nc" id="L363">    }</span>

    /**
     * Returns the order the property shall be sorted for.
     *
     * @return
     */
    public Direction getDirection() {
<span class="nc" id="L371">      return direction;</span>
    }

    /**
     * Returns the property to order for.
     *
     * @return
     */
    public String getProperty() {
<span class="nc" id="L380">      return property;</span>
    }

    /**
     * Returns whether sorting for this property shall be ascending.
     *
     * @return
     */
    public boolean isAscending() {
<span class="nc" id="L389">      return this.direction.isAscending();</span>
    }

    /**
     * Returns whether sorting for this property shall be descending.
     *
     * @return
     * @since 1.13
     */
    public boolean isDescending() {
<span class="nc" id="L399">      return this.direction.isDescending();</span>
    }

    /**
     * Returns whether the sort will be case-sensitive or case-insensitive.
     *
     * @return
     */
    public boolean isIgnoreCase() {
<span class="nc" id="L408">      return ignoreCase;</span>
    }

    /**
     * Returns a new {@link Order} with the given {@link Direction}.
     *
     * @param direction
     * @return
     */
    public Order with(Direction direction) {
<span class="nc" id="L418">      return new Order(direction, this.property, this.ignoreCase, this.nullHandling);</span>
    }

    /**
     * Returns a new {@link Order}
     *
     * @param property must not be {@literal null} or empty.
     * @return
     * @since 1.13
     */
    public Order withProperty(String property) {
<span class="nc" id="L429">      return new Order(this.direction, property, this.ignoreCase, this.nullHandling);</span>
    }

    /**
     * Returns a new {@link SortRequest} instance for the given properties.
     *
     * @param properties
     * @return
     */
    public SortRequest withProperties(String... properties) {
<span class="nc" id="L439">      return SortRequest.by(this.direction, properties);</span>
    }

    /**
     * Returns a new {@link Order} with case insensitive sorting enabled.
     *
     * @return
     */
    public Order ignoreCase() {
<span class="nc" id="L448">      return new Order(direction, property, true, nullHandling);</span>
    }

    /**
     * Returns a {@link Order} with the given {@link NullHandling}.
     *
     * @param nullHandling can be {@literal null}.
     * @return
     * @since 1.8
     */
    public Order with(NullHandling nullHandling) {
<span class="nc" id="L459">      return new Order(direction, this.property, ignoreCase, nullHandling);</span>
    }

    /**
     * Returns a {@link Order} with {@link NullHandling#NULLS_FIRST} as null handling hint.
     *
     * @return
     * @since 1.8
     */
    public Order nullsFirst() {
<span class="nc" id="L469">      return with(NullHandling.NULLS_FIRST);</span>
    }

    /**
     * Returns a {@link Order} with {@link NullHandling#NULLS_LAST} as null handling hint.
     *
     * @return
     * @since 1.7
     */
    public Order nullsLast() {
<span class="nc" id="L479">      return with(NullHandling.NULLS_LAST);</span>
    }

    /**
     * Returns a {@link Order} with {@link NullHandling#NATIVE} as null handling hint.
     *
     * @return
     * @since 1.7
     */
    public Order nullsNative() {
<span class="nc" id="L489">      return with(NullHandling.NATIVE);</span>
    }

    /**
     * Returns the used {@link NullHandling} hint, which can but may not be respected by the used datastore.
     *
     * @return
     * @since 1.7
     */
    public NullHandling getNullHandling() {
<span class="nc" id="L499">      return nullHandling;</span>
    }

    /*
     * (non-Javadoc)
     * @see java.lang.Object#hashCode()
     */
    @Override
    public int hashCode() {

<span class="nc" id="L509">      int result = 17;</span>

<span class="nc" id="L511">      result = 31 * result + direction.hashCode();</span>
<span class="nc" id="L512">      result = 31 * result + property.hashCode();</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">      result = 31 * result + (ignoreCase ? 1 : 0);</span>
<span class="nc" id="L514">      result = 31 * result + nullHandling.hashCode();</span>

<span class="nc" id="L516">      return result;</span>
    }

    /*
     * (non-Javadoc)
     * @see java.lang.Object#equals(java.lang.Object)
     */
    @Override
    public boolean equals(Object obj) {

<span class="nc bnc" id="L526" title="All 2 branches missed.">      if (this == obj) {</span>
<span class="nc" id="L527">        return true;</span>
      }

<span class="nc bnc" id="L530" title="All 2 branches missed.">      if (!(obj instanceof Order)) {</span>
<span class="nc" id="L531">        return false;</span>
      }

<span class="nc" id="L534">      Order that = (Order) obj;</span>

<span class="nc bnc" id="L536" title="All 2 branches missed.">      return this.direction.equals(that.direction)</span>
<span class="nc bnc" id="L537" title="All 4 branches missed.">          &amp;&amp; this.property.equals(that.property)</span>
          &amp;&amp; this.ignoreCase == that.ignoreCase
<span class="nc bnc" id="L539" title="All 2 branches missed.">          &amp;&amp; this.nullHandling.equals(that.nullHandling);</span>
    }

    /*
     * (non-Javadoc)
     * @see java.lang.Object#toString()
     */
    @Override
    public String toString() {

<span class="nc" id="L549">      String result = String.format(&quot;%s: %s&quot;, property, direction);</span>

<span class="nc bnc" id="L551" title="All 2 branches missed.">      if (!NullHandling.NATIVE.equals(nullHandling)) {</span>
<span class="nc" id="L552">        result += &quot;, &quot; + nullHandling;</span>
      }

<span class="nc bnc" id="L555" title="All 2 branches missed.">      if (ignoreCase) {</span>
<span class="nc" id="L556">        result += &quot;, ignoring case&quot;;</span>
      }

<span class="nc" id="L559">      return result;</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>